// Sidebar.js
// –ö–æ–º–ø–æ–Ω–µ–Ω—Ç –º–æ–±–∏–ª—å–Ω–æ–≥–æ –≤—ã–µ–∑–∂–∞—é—â–µ–≥–æ –º–µ–Ω—é (—Å–∞–π–¥–±–∞—Ä–∞).
// –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –æ—Å–Ω–æ–≤–Ω—ã–º —ç–ª–µ–º–µ–Ω—Ç–∞–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º, –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º —è–∑—ã–∫–∞
// –∏ —Ä–∞–Ω–µ–µ —Å–æ–¥–µ—Ä–∂–∞–ª —Å–ø–∏—Å–æ–∫ –∑–¥–∞–Ω–∏–π (—Ç–µ–ø–µ—Ä—å —Å–ø–∏—Å–æ–∫ —É–¥–∞–ª–µ–Ω).

function Sidebar() {
    // –ü–æ–ª—É—á–∞–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ —Ñ—É–Ω–∫—Ü–∏–∏ –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–≤ React
    const { 
        t,                // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞
        currentLang,      // –¢–µ–∫—É—â–∏–π –≤—ã–±—Ä–∞–Ω–Ω—ã–π —è–∑—ã–∫
        switchLanguage    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–º–µ–Ω—ã —è–∑—ã–∫–∞
    } = React.useContext(LanguageContext);

    const {
        gridSize,             // –¢–µ–∫—É—â–∏–π —Ä–∞–∑–º–µ—Ä —Å–µ—Ç–∫–∏
        setGridSize,          // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–æ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ —Å–µ—Ç–∫–∏
        isGridRotated,        // –§–ª–∞–≥, –ø–æ–≤–µ—Ä–Ω—É—Ç–∞ –ª–∏ —Å–µ—Ç–∫–∞
        toggleGridRotation,   // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ –ø–æ–≤–æ—Ä–æ—Ç–∞
        showDistanceToHG,     // –§–ª–∞–≥, –∞–∫—Ç–∏–≤–µ–Ω –ª–∏ —Ä–µ–∂–∏–º "—Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –¥–æ –ê–¥—Å–∫–∏—Ö –í—Ä–∞—Ç"
        toggleDistanceToHG,   // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–π
        handleSaveState,      // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å—Å—ã–ª–∫–∏ ("–ü–æ–¥–µ–ª–∏—Ç—å—Å—è")
        onToggleSidebar,      // –§—É–Ω–∫—Ü–∏—è –∏–∑ AppStateContext –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è —Å–∞–π–¥–±–∞—Ä–∞
        isMobileView          // –§–ª–∞–≥, –∞–∫—Ç–∏–≤–µ–Ω –ª–∏ –º–æ–±–∏–ª—å–Ω—ã–π –≤–∏–¥ (—Å–∞–π–¥–±–∞—Ä –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö)
        // isSidebarOpen      // –°–æ—Å—Ç–æ—è–Ω–∏–µ isSidebarOpen —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ App.js –∏ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∫–ª–∞—Å—Å –Ω–∞ body
    } = React.useContext(AppStateContext);

    // –õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –ø–æ–ª—è –≤–≤–æ–¥–∞ —Ä–∞–∑–º–µ—Ä–∞ —Å–µ—Ç–∫–∏ –≤–Ω—É—Ç—Ä–∏ —Å–∞–π–¥–±–∞—Ä–∞.
    // –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤–≤–æ–¥–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ, –∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∫ –≥–ª–æ–±–∞–ª—å–Ω–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é
    // –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ Blur –∏–ª–∏ Enter.
    const [localGridSizeMobile, setLocalGridSizeMobile] = React.useState(gridSize.toString());

    // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–Ω–ø—É—Ç–∞ —Å –≥–ª–æ–±–∞–ª—å–Ω—ã–º gridSize,
    // –µ—Å–ª–∏ gridSize –∏–∑–º–µ–Ω–∏–ª—Å—è –∏–∑–≤–Ω–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è).
    React.useEffect(() => {
        setLocalGridSizeMobile(gridSize.toString());
    }, [gridSize]);

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏—è –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞ —Ä–∞–∑–º–µ—Ä–∞ —Å–µ—Ç–∫–∏
    const handleGridSizeInputChangeMobile = (e) => {
        setLocalGridSizeMobile(e.target.value);
    };

    // –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –Ω–æ–≤–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ —Å–µ—Ç–∫–∏, –≤–≤–µ–¥–µ–Ω–Ω–æ–≥–æ –≤ –∏–Ω–ø—É—Ç —Å–∞–π–¥–±–∞—Ä–∞
    const applyGridSizeMobile = () => {
        const newSize = parseInt(localGridSizeMobile, 10);
        // setGridSize –∏–∑ AppStateContext —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–æ–≥–∏–∫—É –≤–∞–ª–∏–¥–∞—Ü–∏–∏
        setGridSize(newSize); 
    };
    
    // –†–µ–Ω–¥–µ—Ä–∏–º —Å–∞–π–¥–±–∞—Ä —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∞–∫—Ç–∏–≤–µ–Ω –º–æ–±–∏–ª—å–Ω—ã–π –≤–∏–¥.
    // –•–æ—Ç—è –æ—Å–Ω–æ–≤–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç—å—é —Å–∞–π–¥–±–∞—Ä–∞ (–∫–ª–∞—Å—Å .open) –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ App.js,
    // —ç—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å –∫–æ–Ω—Ç—Ä–æ–ª—è.
    if (!isMobileView) {
        // return null; // –ú–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å null, –Ω–æ –∫–ª–∞—Å—Å .mobile-only –Ω–∞ <div id="mobileSidebar"> –≤ index.html –¥–æ–ª–∂–µ–Ω —É–∂–µ –µ–≥–æ —Å–∫—Ä—ã—Ç—å.
        // –î–ª—è —á–∏—Å—Ç–æ—Ç—ã, –µ—Å–ª–∏ —ç—Ç–æ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤—Å–µ–≥–¥–∞ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è, –∞ –≤–∏–¥–∏–º–æ—Å—Ç—å —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è CSS, —Ç–æ —ç—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ –Ω—É–∂–Ω–∞.
        // –û–¥–Ω–∞–∫–æ, –µ—Å–ª–∏ App.js —Ä–µ—à–∞–µ—Ç –Ω–µ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å Sidebar –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ, —Ç–æ —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ.
        // –í —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–µ App.js –æ–Ω —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è —É—Å–ª–æ–≤–Ω–æ: {isMobileView && <Sidebar />}
    }

    return (
        // –ê—Ç—Ä–∏–±—É—Ç id="mobileSidebar" –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–∏–¥–∏–º–æ—Å—Ç—å—é —á–µ—Ä–µ–∑ –∫–ª–∞—Å—Å 'open' –∏–∑ App.js
        // –ö–ª–∞—Å—Å "sidebar" - –æ—Å–Ω–æ–≤–Ω–æ–π —Å—Ç–∏–ª–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∫–ª–∞—Å—Å.
        // –ö–ª–∞—Å—Å "mobile-only" –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –æ–Ω –±—É–¥–µ—Ç —Å–∫—Ä—ã—Ç –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ —á–µ—Ä–µ–∑ CSS.
        <div id="mobileSidebar" className="sidebar mobile-only"> {/* –ö–ª–∞—Å—Å .open –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –∏–∑ App.js */}
            {/* –ö–Ω–æ–ø–∫–∞ "–∫—Ä–µ—Å—Ç–∏–∫" –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è —Å–∞–π–¥–±–∞—Ä–∞ */}
            <a 
                href="javascript:void(0)" // –ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ —Å—Å—ã–ª–∫–µ
                className="close-btn" 
                onClick={onToggleSidebar} // –í—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é –∑–∞–∫—Ä—ã—Ç–∏—è –∏–∑ AppStateContext
                aria-label={t('closeSidebarLabel')} // –î–ª—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
                role="button" // –Ø–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ–º —Ä–æ–ª—å –∫–Ω–æ–ø–∫–∏ –¥–ª—è –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
            >
                √ó {/* –°–∏–º–≤–æ–ª "times" (–∫—Ä–µ—Å—Ç–∏–∫) */}
            </a>
            
            {/* –°–µ–∫—Ü–∏—è —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è */}
            <div className="sidebar-section" id="sidebarControls">
                <h4>{t('controlsHeader')}</h4>
                <button 
                    id="shareButtonMobile" 
                    className="sidebar-btn control-btn" // –û–±—â–∏–µ –∫–ª–∞—Å—Å—ã –¥–ª—è –∫–Ω–æ–ø–æ–∫ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                    onClick={handleSaveState}
                >
                    {/* –ò–∫–æ–Ω–∫–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∞ —á–µ—Ä–µ–∑ CSS –ø—Å–µ–≤–¥–æ—ç–ª–µ–º–µ–Ω—Ç –∏–ª–∏ –∫–∞–∫ <span> */}
                    <span className="icon">üîó</span> {/* –ü—Ä–∏–º–µ—Ä –∏–∫–æ–Ω–∫–∏ */}
                    <span className="text">{t('shareLink')}</span>
                </button>
                
                <div className="sidebar-grid-controls"> {/* –û–±–µ—Ä—Ç–∫–∞ –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ç–∫–æ–π */}
                    <label htmlFor="gridSizeInputMobileSidebar">{t('gridSizeLabel')}</label>
                    <input
                        type="number"
                        id="gridSizeInputMobileSidebar" // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è —Å–≤—è–∑–∏ —Å label
                        className="grid-size-input" // –û–±—â–∏–π –∫–ª–∞—Å—Å –¥–ª—è –∏–Ω–ø—É—Ç–æ–≤ —Ä–∞–∑–º–µ—Ä–∞
                        min={window.appConstants.MIN_GRID_SIZE}
                        max={window.appConstants.MAX_GRID_SIZE}
                        value={localGridSizeMobile}
                        onChange={handleGridSizeInputChangeMobile}
                        onBlur={applyGridSizeMobile} // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Ñ–æ–∫—É—Å–∞
                        onKeyDown={(e) => { if (e.key === 'Enter') applyGridSizeMobile(); }} // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ Enter
                    />
                    <button onClick={applyGridSizeMobile} className="sidebar-btn">{t('apply')}</button>
                </div>
                
                <button
                    id="rotateGridButtonMobileSidebar" // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
                    className={`sidebar-btn control-btn ${isGridRotated ? 'active' : ''}`}
                    onClick={toggleGridRotation}
                >
                    <span className="icon">üîÑ</span> {/* –ü—Ä–∏–º–µ—Ä –∏–∫–æ–Ω–∫–∏ */}
                    <span className="text">{isGridRotated ? t('resetRotation') : t('rotateGrid')}</span>
                </button>
                <button
                    id="distanceToHGButtonMobileSidebar" // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
                    className={`sidebar-btn control-btn ${showDistanceToHG ? 'active' : ''}`}
                    onClick={toggleDistanceToHG}
                >
                     <span className="icon">üìè</span> {/* –ü—Ä–∏–º–µ—Ä –∏–∫–æ–Ω–∫–∏ */}
                    <span className="text">{t('distanceToHGLabel')}</span>
                </button>
            </div>
            
            {/* –°–µ–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —è–∑—ã–∫–æ–≤ */}
            <div className="sidebar-section" id="sidebarLanguage">
                <h4>{t('languageHeader')}</h4>
                <div className="language-switcher-mobile">
                    {/* –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ —è–∑—ã–∫–∞ */}
                    {Object.keys(window.appTranslations.data.title).map((langCode) => (
                        <button
                            key={langCode}
                            className={`language-btn ${currentLang === langCode ? 'active' : ''}`}
                            onClick={() => {
                                switchLanguage(langCode);
                                // –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –º–æ–∂–Ω–æ –∑–∞–∫—Ä—ã–≤–∞—Ç—å —Å–∞–π–¥–±–∞—Ä –ø–æ—Å–ª–µ —Å–º–µ–Ω—ã —è–∑—ã–∫–∞
                                // onToggleSidebar(); 
                            }}
                            lang={langCode} // –ê—Ç—Ä–∏–±—É—Ç lang –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏ –≤–æ–∑–º–æ–∂–Ω–æ–π —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏
                        >
                            {/* –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫–æ–¥ —è–∑—ã–∫–∞ –≤ –≤–µ—Ä—Ö–Ω–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, "RU", "EN", "PT") */}
                            {langCode.split('_')[0].toUpperCase()}
                        </button>
                    ))}
                </div>
            </div>
            {/* –ü–∞–Ω–µ–ª—å —Å–ø–∏—Å–∫–∞ –∑–¥–∞–Ω–∏–π –±—ã–ª–∞ —É–¥–∞–ª–µ–Ω–∞ –∏–∑ —Å–∞–π–¥–±–∞—Ä–∞, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–∞ —É–ø—Ä–∞–∑–¥–Ω–µ–Ω–∞ */}
        </div>
    );
}

// –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–ª—é—á 'closeSidebarLabel' –¥–æ–±–∞–≤–ª–µ–Ω –≤ translations.js –¥–ª—è –≤—Å–µ—Ö —è–∑—ã–∫–æ–≤.
// –ò–∫–æ–Ω–∫–∏ üîó, üîÑ, üìè - —ç—Ç–æ –ø—Ä–∏–º–µ—Ä—ã, –∏—Ö –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ SVG –∏–ª–∏ —à—Ä–∏—Ñ—Ç–æ–≤—ã–µ –∏–∫–æ–Ω–∫–∏ –¥–ª—è –ª—É—á—à–µ–≥–æ –≤–∏–¥–∞.
// –î–ª—è –∫–Ω–æ–ø–æ–∫ —Å –∏–∫–æ–Ω–∫–∞–º–∏ –∏ —Ç–µ–∫—Å—Ç–æ–º, –µ—Å–ª–∏ –Ω–∞ –æ—á–µ–Ω—å –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö —Ç–µ–∫—Å—Ç –±—É–¥–µ—Ç –º–µ—à–∞—Ç—å,
// –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –º–µ–¥–∏–∞-–∑–∞–ø—Ä–æ—Å –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è .text –≤–Ω—É—Ç—Ä–∏ .sidebar-btn.